<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="color-scheme" content="light dark" />
    <title>{% block title %}MedicalXtractor{% endblock %}</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='styles.css') }}"
    />
    {% block extra_css %}{% endblock %}
  </head>
  <body>
    <nav class="navbar">
      <div class="nav-left">
        <h1>MedicalXtractor</h1>
        <a href="{{ url_for('index') }}" class="home-button">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="24" height="24">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9 22 9 12 15 12 15 22"></polyline>
          </svg>
        </a>
      </div>
      <div class="nav-right">
        <a href="{{ url_for('documents') }}">Documents</a>
        <a href="{{ url_for('prescriptions') }}">Prescriptions</a>
        <a href="{{ url_for('summarizer') }}">Summaries</a>
        <button
          class="theme-toggle"
          id="theme-toggle"
          title="Toggle dark mode"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="sun-icon"
          >
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
          </svg>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="moon-icon"
            style="display: none"
          >
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
          </svg>
        </button>
      </div>
    </nav>

    <div class="container">{% block content %}{% endblock %}</div>

    <footer class="footer">
      <p>&copy; 2025 MedicalXtractor. All rights reserved. | <a href="{{ url_for('credits') }}">Credits</a></p>
    </footer>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const themeToggle = document.getElementById("theme-toggle");
        const sunIcon = themeToggle.querySelector(".sun-icon");
        const moonIcon = themeToggle.querySelector(".moon-icon");
        const html = document.documentElement;

        // Vérifier la préférence système
        const prefersDark = window.matchMedia(
          "(prefers-color-scheme: dark)"
        ).matches;

        // Charger le thème depuis le localStorage ou utiliser la préférence système
        const savedTheme =
          localStorage.getItem("theme") || (prefersDark ? "dark" : "light");
        applyTheme(savedTheme);

        // Écouter les changements de préférence système
        window
          .matchMedia("(prefers-color-scheme: dark)")
          .addEventListener("change", (e) => {
            if (!localStorage.getItem("theme")) {
              applyTheme(e.matches ? "dark" : "light");
            }
          });

        themeToggle.addEventListener("click", () => {
          const currentTheme = html.getAttribute("data-theme");
          const newTheme = currentTheme === "light" ? "dark" : "light";
          applyTheme(newTheme);
          localStorage.setItem("theme", newTheme);
        });

        function applyTheme(theme) {
          html.setAttribute("data-theme", theme);
          updateIcons(theme);

          // Mettre à jour la meta color-scheme
          document.querySelector('meta[name="color-scheme"]').content = theme;
        }

        function updateIcons(theme) {
          sunIcon.style.display = theme === "dark" ? "none" : "block";
          moonIcon.style.display = theme === "dark" ? "block" : "none";
        }
      });
    </script>

    {% block scripts %}{% endblock %}
  </body>
</html>
